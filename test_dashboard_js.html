<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Data Test</title>
</head>
<body>
    <h1>Dashboard Data Test</h1>
    <div id="results"></div>
    
    <script>
        async function testDashboardData() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Test loading portfolio data
                const response = await fetch('/crypto-bot/data/portfolio_data.json');
                const portfolio = await response.json();
                
                resultsDiv.innerHTML += '<h2>Portfolio Data Loaded Successfully</h2>';
                resultsDiv.innerHTML += '<pre>' + JSON.stringify(portfolio, null, 2) + '</pre>';
                
                // Test the asset filtering logic
                const assets = Object.keys(portfolio).filter(key => 
                    typeof portfolio[key] === 'object' && 
                    portfolio[key] !== null && 
                    'amount' in portfolio[key]
                );
                
                resultsDiv.innerHTML += '<h2>Filtered Assets: ' + assets.join(', ') + '</h2>';
                
                // Test SOL specifically
                if (portfolio.SOL) {
                    const sol = portfolio.SOL;
                    resultsDiv.innerHTML += '<h2>SOL Data:</h2>';
                    resultsDiv.innerHTML += '<p>Amount: ' + sol.amount + '</p>';
                    resultsDiv.innerHTML += '<p>Price: $' + sol.last_price_usd + '</p>';
                    resultsDiv.innerHTML += '<p>Value: $' + sol.value_usd + '</p>';
                    resultsDiv.innerHTML += '<p>Allocation: ' + sol.allocation + '%</p>';
                } else {
                    resultsDiv.innerHTML += '<h2>❌ SOL not found in portfolio</h2>';
                }
                
                // Generate table HTML like the dashboard does
                let tableHtml = `
                    <h2>Generated Table HTML:</h2>
                    <table border="1">
                        <thead>
                            <tr>
                                <th>Asset</th>
                                <th>Amount</th>
                                <th>Value (USD)</th>
                                <th>Allocation</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                for (const asset of assets) {
                    if (portfolio[asset]) {
                        const amount = portfolio[asset].amount || 0;
                        const valueUsd = portfolio[asset].value_usd || 0;
                        const allocation = portfolio[asset].allocation || 0;
                        
                        // Format amount based on asset type
                        let formattedAmount;
                        if (asset === 'BTC') {
                            formattedAmount = amount.toFixed(8);
                        } else if (asset === 'ETH') {
                            formattedAmount = amount.toFixed(6);
                        } else if (asset === 'SOL') {
                            formattedAmount = amount.toFixed(4);
                        } else if (asset === 'USD') {
                            formattedAmount = amount.toFixed(2);
                        } else {
                            formattedAmount = amount.toFixed(6);
                        }
                        
                        tableHtml += `
                            <tr>
                                <td>${asset}</td>
                                <td>${formattedAmount}</td>
                                <td>$${valueUsd.toFixed(2)}</td>
                                <td>${allocation.toFixed(2)}%</td>
                            </tr>
                        `;
                    }
                }
                
                tableHtml += `
                        </tbody>
                    </table>
                `;
                
                resultsDiv.innerHTML += tableHtml;
                
            } catch (error) {
                resultsDiv.innerHTML += '<h2>❌ Error: ' + error.message + '</h2>';
                console.error('Error:', error);
            }
        }
        
        // Run the test when page loads
        window.onload = testDashboardData;
    </script>
</body>
</html>
